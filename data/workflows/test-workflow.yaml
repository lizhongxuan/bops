version: v0.1
name: test-workflow
description: test workflo

inventory:
  hosts:
    local:
      address: 127.0.0.1
    web:
      address: 127.0.0.1

plan:
  mode: manual-approve
  strategy: sequential

steps:
  - name: run command
    targets: [local]
    action: cmd.run

  - name: run command5
    targets: [local]
    action: cmd.run
    with:
      cmd: "echo hello22"

  - name: render config
    targets: [web]
    action: template.render
    with:
      src: nginx.conf.j2
      dest: /etc/nginx/nginx.conf

  - name: install package
    targets: [web]
    action: pkg.install
    with:
      name: nginx

  - name: ensure service
    targets: [web]
    action: service.ensure
    with:
      name: nginx
      state: started

  - name: set env
    targets: [local]
    action: env.set
    with:
      env:
        TOKEN: ""

  - name: run shell script
    targets: [web]
    action: script.shell
    with:
      script: |
        echo "hello from shell"
